@startuml PaperTrading_Module_Detail

actor Trader
actor "Data Module" as DataModule
actor "Supabase" as DB

rectangle "Paper Trading Module" {
    usecase "Start Paper Trading" as UC7
    usecase "Initialize Virtual Account" as UC7_1
    usecase "Subscribe to Market Data" as UC7_2
    usecase "Load Strategy" as UC7_3
    usecase "Start Monitoring" as UC7_4
    
    usecase "Place Virtual Orders" as UC9
    usecase "Generate Signal" as UC9_1
    usecase "Validate Order" as UC9_2
    usecase "Match Order (Virtual)" as UC9_3
    usecase "Execute in Database" as UC9_4
    usecase "Update Position" as UC9_5
    
    usecase "Monitor Positions" as UC8
    usecase "Check Open Positions" as UC8_1
    usecase "Track SL/TP Triggers" as UC8_2
    usecase "Calculate Real-time P&L" as UC8_3
    usecase "Auto-close on SL/TP Hit" as UC8_4
    usecase "Close Positions Manually" as UC8_5
    
    usecase "Sync to Cloud" as UC11
    usecase "Upload Trades" as UC11_1
    usecase "Backup State" as UC11_2
    usecase "Enable Real-time Updates" as UC11_3
}

' Main flow
Trader --> UC7
UC7 .> UC7_1 : <<include>>
UC7 .> UC7_2 : <<include>>
UC7 .> UC7_3 : <<include>>
UC7 .> UC7_4 : <<include>>

' Paper Trading gets data from Data Module (not direct MT5)
UC7_2 ..> DataModule : <<uses>>

note right of UC7_2
  Gets real-time price feed
  from Data Module, but does NOT
  submit orders to MT5 broker.
  Purely virtual simulation.
end note

' Order flow
UC7 --> UC9
UC9 .> UC9_1 : <<include>>
UC9 .> UC9_2 : <<include>>
UC9 .> UC9_3 : <<include>>
UC9 .> UC9_4 : <<include>>
UC9 .> UC9_5 : <<include>>

UC9_4 ..> DB : <<uses>>

' Monitoring flow
Trader --> UC8
UC8 .> UC8_1 : <<include>>
UC8 .> UC8_2 : <<include>>
UC8 .> UC8_3 : <<include>>
UC8 .> UC8_4 : <<include>>
UC8 .> UC8_5 : <<include>>

' Sync flow
UC8 --> UC11
UC11 .> UC11_1 : <<include>>
UC11 .> UC11_2 : <<include>>
UC11 .> UC11_3 : <<include>>

UC11_1 ..> DB : <<uses>>

note right of UC9
  Virtual execution:
  - No real money
  - Real market data (via Data Module)
  - Realistic order matching
  - SL/TP automation
  - Database tracking
  - Shared with Backtest Engine
end note

note right of UC8_4
  Auto-close positions when:
  - Stop Loss hit
  - Take Profit hit
  Fully tested (49/49 tests)
end note

@enduml